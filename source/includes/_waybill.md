# Waybill 

## Overview
This service is used to create a waybill shipping entry into the BEX courier database. 
This allows BEX customers to directly interface their shipping requests and helps to 
eliminate errors as a result of manual data capture or misinterpretation of written content 
on shipping documentation.
The service allows for the communication of a number of shipping options, such as:

* Full addressing of both the sending and receiving parties
* Additional shipping references against which the shipping entry is to be tagged
* Multiple packages and their associated dimensions and weights
* Special handling requests such as after-hour, Saturday or public holiday deliveries

## Endpoint
    Service Relative URL: `/api/service/submitwaybillwia`

### Waybill Parameters

The parameter requirements for this api call have been broken down into three sub-sections,
namely:

* Addresses - Contains parameters for the construction and routing information of the Waybill 
* Dimensioning
* Service Add-Ons

## Addresses

> Sample json message body.

```json
{
  "waybillNumber": "ST116664",
  "waybillDate": "2021-09-23",
  "serviceCode": "NCA",
  "accountNumber": "316085",
  "sendersRef": "you-can-put-your-own-references-here",
  "originCompany": "MARTINNAISE (PTY) LTD",
  "originFloorBuilding": "1ST FLOOR",
  "originStreet": "12 MODDERFONTEIN STREET",
  "originLocationName": "MODDERFONTEIN",
  "originCity": "",
  "originPostCode": "1645",
  "destinationCompany": "SPUR STEAK RANCHES",
  "destinationFloorBuilding": "UNIT 1",
  "destinationStreet": "165 MAIN RD",
  "destinationLocationName": "MUIZENBERG",
  "destinationCity": "",
  "destinationPostCode": "7950",
  "receiverContactName": "SHARON SNYMAN",
  "receiverMobile": "",
  "receiverEmail": "",
  "receiverTelephone": "+27811234512",
  "senderContactName": "",
  "senderMobile": "",
  "senderEmail": "",
  "senderTelephone": "",
  "specialInstructions": "PLEASE SIGN HANDOVER SHEET",
  "sursat": "",
  "surpub": "",
  "surahs": "",
  "insuranceRequired": "FALSE",
  "insuranceValue": 0,
  "returnParcelPrintingText": "FALSE",
  "printParcels": "FALSE",
  "printUrl": "",
  "originLat": 0,
  "originLon": null,
  "destinationLat": -26.11682,
  "destinationLon": 28.17926,
  "dimensions": [{"dimension1": "45","dimension2": "45","dimension3": "50","weight": "18","barcodeNumber": "ST116664_P1"}]
}
```

Parameter | FieldType | Case | Required | Note
--------- | --------- | ---- | ---------| ---- 
AccountNumber | String | No | Yes | 
SendersRef | String | No | No | For tracking, reporting and invoice requests
WaybillNumber | String | No(See below) | No | BEX issued number

WaybillNumber is auto-generated by BEX and communicated in the service response when making use of alternative shipping stationary options such as thermal labels or A4 waybills

Parameter | FieldType | Case | Required | Note
--------- | --------- | ---- | -------- | ---- 
WaybillDate | Date | No | No | Date of collection by BEX. Format yyyy-mm-dd
ServiceCode | String | No | Yes | The service delivery priority code

Service delivery code values are:

*SDX - Sameday Express
*DBD - Daybreak Delivery
*ONC - Overnight Courier
*NCA - Normal Cargo
*BUD - Budget Cargo

Parameter | FieldType | Case | Required | Note
--------- | --------- | ---- | -------- | ------- 
OriginCompany | String | No | No | Company from which to collect
OriginFloorBuilding | String | No | Yes | Floor, building, office park
OriginStreet | String | No | Yes | Street for shipment collection
OriginLocationName | String | No | Yes | Sender suburb
OriginPostCode | String | No | Yes | Sender postcode
SenderContactName | String | No | No | Contact person for collection/dispatch
SenderTelephone | String | No | No | Contact person telephone number
SenderMobile | String | No | No | Contact person mobile number

SenderMobile is useful for shipment progress updates

Parameter | FieldType | Case | Required | Note
--------- | --------- | ---- | -------- | ------- 
SenderEmail | String | No | No | For progress updates 
DestinationCompany | String | No | No | Receiver individual/company name
DestinationFloorBuilding | String | No | No | Floor and building address.

Used for single receiver shipment only (optional)

Parameter | FieldType | Case | Required | Note
--------- | --------- | ---- | -------- | ------- 
DestinationStreet | String | No | No | Receiver street number and name
DestinationLocationName | String | No | Yes | Receiver suburb .
DestinationPostCode | String | Yes | No | Receiver postcode
ReceiverContactName | String | No | No | Receiver name.
ReceiverTelephone | String | No | No | Receiver telephone number
ReceiverMobile | String | No | No | Useful for status updates
ReceiverEmail | String | No | No | Useful for status updates
InsuranceRequired | Boolean | No | No | 

If TRUE the insurance surcharge is added to the waybill and insurance cover is placed for the goods during shipping

Parameter | FieldType | Case | Required | Note
--------- | --------- | ---- | -------- | ------- 
InsuranceValue | Float/Double | No | No | Insured value, in ZAR
Instructions | String | No | No | Communicate additional info


The following parameters MUST correspond to the Dimensions Array

Parameter | FieldType | Required | Note
--------- | --------- | -------- | --------
TotalPieces | Int | Yes | Total number of packages on this waybill number. Must match COUNT of individual parcel objects in the dimensions array.
ActualWeight | Float | Yes | The total weight in kilograms, of all of the packages on this waybill number. Must match SUM of individual parcel objects in the dimensions array.

<aside class="notice">
    Should you not have the individual weights of each package to be shipped on the waybill
you can state the total weight of all of the parcels in one of the dimension array’s weight field,
followed by zeroes for the remaining weights in the dimensions array.
</aside>


## Dimensioning

The dimensioning sub-section contains information pertinent to the parcels that make up this
waybill shipping request.

Parameter | FieldType | Case | Required
--------- | --------- | ---- | -------- 
Dimensions| Array | No | Yes |

### Dimensions Array

* For communication of parcel specific information for each package that comprises this waybill shipping request
* The array contains parcel dimension objects with the following properties

FieldName | FieldType | Req | Description
--------- | --------- | --- | -----------
BarcodeNumber | String | No | The barcode number of the parcel label used for this package
Dimension1 | Int | Yes | Length of the package, rounded up to the nearest whole centimeter
Dimension2 | Int | Yes | Width of the package, rounded up to the nearest whole centimeter
Dimension3 | Int | Yes | Height of the package, rounded up to the nearest whole centimeter
Weight | Float | Yes | Actual weight of package in kilograms
Reference | String | No | Tag this package with parcel specific information.

## Service Add-Ons

The service add-ons sub-section contains information specific to additional options that can be
requested over and above the respective delivery service product offerings. Currently this pertains to 
after-hour delivery requests but will be extended to features such as live delivery e-mail
and sms alerts.

Parameter | FieldType | Case | Required 
--------- | --------- | ---- | -------- 
AdditionalSurcharges| Array | No | No 

### AdditionalSurcharges| Array

FieldName | FieldType | Req 
--------- | --------- | ---
SurchargeCode | String | No 

The codes for the service add-ons that are requested:
* SURSAT - Saturday Delivery
* SURPUB - Public Holiday Delivery
* SURAHS - After Hours Delivery Handling

## Waybill Transportation


> jQuery Waybill Submission Example.

```javascript
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>BEX waybill API example</title>
<script src="http://code.jquery.com/jquerylatest.min.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">
//********** Login Service Call ********************
var tokenStr = '';
var user = encodeURIComponent('someusername'); //encode the username
var pass = encodeURIComponent('somepassword'); //encode the password
var host = 'https://beta.bex.co.za';
//********** Submit Waybill Service Call ***********
// ADDRESSING
var postData = {}
postData.accountNumber = '111983';
postData.waybillNumber = 'IT2701152404';
postData.waybillDate = '20150127';
postData.sendersRef = 'WE HAVE A REFERENCE';
postData.serviceCode = 'NCA';
// SENDER ADDRESS
postData.originCompany = 'THE BOEING COMPANY';
postData.originFloorBuilding = 'UNIT 6 ASSEMBLY BUILDING';
postData.originStreet = '21 AIRCRAFT LANE';
postData.originLocationName = 'MARLBORO';
postData.originPostCode = '2050';
postData.senderContactName = 'JONATHAN';
postData.senderTelephone = '0119299700';
postData.senderMobile = '0821234321';
postData.senderEmail = 'JONATHAN@BOEING.COM';
// DESTINATION ADDRESS
postData.destinationCompany = 'THE AIRLINER CO';
postData.destinationFloorBuilding = '1ST FLOOR HEAD OFFICE';
postData.destinationStreet = '21 TULP STREET';
postData.destinationLocationName = 'MILNERTON';
postData.destinationPostCode = '7401';
postData.receiverContactName = 'DEREK';
postData.receiverTelephone = '0218641202';
postData.receiverMobile = '0833211234';
postData.receiverEmail = 'DEREK@THEAIRLINER.COM';
// GENERAL
postData.insuranceRequired = true;
postData.insuranceValue = 1000;
postData.instructions = 'DO NOT INVERT COMPONENT';
// PIECE INFORMATION
var totalPieces = 2;
var actualWeight = 12.3;
// ADDITIONAL REFERENCES
var additionalReferences = [];
var reference1 = {};
reference1.value = 'REFERENCE ONE';
additionalReferences.push(reference1);
postData.AdditionalReferneces = additionalReferences;
// DIMENSIONING
var dims = [];
var firstDim = {};
firstDim.barcodeNumber = postData.waybillNumber + 'P1';
firstDim.Dimension1 = 10;
firstDim.Dimension2 = 20;
firstDim.Dimension3 = 30;
firstDim.Weight = 12.3;
firstDim.Reference = 'AIRFRAME COMPONENT';
dims.push(firstDim);
postData.Dimensions = dims;
var jsonData = JSON.stringify(postData);
jQuery.support.cors = true; //this will enable cross domain access for
all services
//call the service using jQuery ajax and passing the parameters
$.ajax({
url: host + '/api/service/login?username=' + user + '&password=' + pass, type: 'POST',
async: false, //dont run asynchronously
success: function (data) {
if (data.ex) { //if the network call succeeds, it may still contain an error (ex)
alert('The following error occured: ' + data.ex); //display the error
return;
}
tokenStr = data.value;
},
error: function (ex) { //this will fire for network related issues
alert(ex.responseText);
}
});
//call the service using jQuery ajax and passing the parameters
$.ajax({
type: 'POST',
url: host + '/api/service/submitwaybillwia',
data: jsonData,
dataType: 'json',
contentType: 'application/json; charset=UTF8',
beforeSend: function (xhr) {
xhr.setRequestHeader('token', tokenStr);
},
success: function (data) {
if (data.ex) {
document.write('An error occured: ' + data.ex);
} else {
document.write('A waybill entry was successfully created');
}
},
error: function (ex) { //this will fire for network related issues
alert(ex.responseText);
}
});
</script>
</body>
</html>
```


The service supports GET and POST requests.We recommend POST requests to avoid caching issues.
The service supports URL parameters or JSON parameters in the message body

Example Service Call using JSON message body

* URL: `https://api.bex.co.za/api/service/submitbexcollection`
* BODY: `{“accountNumber”:”112311”,”waybillNumber”:”ABC123456”, “waybillDate”:”2014-12-16”….. etc….. }`


<aside class="notice">
    Please note that all fields must be URL encoded if special characters are used.

</aside>


##Response
The requesting party will receive a server response on the sucessful submission of a waybill request.
The base object will contain a property called “items” which consists of an array
 holding a single object with the following properties:
 
Property | Description
-------- | -----------
waybillNumber | String value reflecting the unique BEX waybill number for this successful shipping request.
baseRateTotal | Price of the rate card billing component for shipment. 
surchargesTotal | Price of the surcharges for additional service add-ons
subTotal | The subtotal, excluding VAT, for the shipment routing requested.
vat | The VAT portion of the pricing for the delivery.
totalCharges | The grand total price for the waybill.
volRatio | The volumetric ratio used during the volumetric weight calculation in the billing engine. This ratio is directly dependant on the service delivery priority requested.

##Submission Failures
Should the collection request fail, the JSON response will contain a property field titled “ex”. This
exception field will communicate the error encountered whilst processing the collection request
and will suggest remedial action so as to ensure the successful saving and processing of the
request on subsequent attempts.


<aside class="notice">
    Should you experience any difficulties in the implementation of this service please contact BEX
Head Office in Johannesburg on +2711 929 9700 and ask for a member of I.T who will gladly assist
you.

</aside>

